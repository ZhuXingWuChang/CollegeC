# 3 数据链路层
- 本章重点:
    1. 数据链路层的点对点信号和王博信道的特点,以及这两种信道所使用的协议(PPP协议以及CSMA/CD协议)的特点.
    2. 数据链路层的三个基本问题:封装成帧&透明传输&差错检测.
    3. 以太网MAC层的硬件地址.
    4. 适配器/转发器/集线器/网桥/以太网交换机的作用以及使用场合.
## 3.1 数据链路层的概念
- 链路(link): 从一个结点到相邻节点的一段 ***物理链路***(有线|无线).
- 数据链路(data link): **link + protocol = data link.** 所以数据链路是一段 ***逻辑链路***.
- 帧(frame): 数据链路层的协议数据单元(PDU).
### 3.1.1 数据链路层的作用
数据链路层负责相邻节点间的链路上数据帧的(可靠)传输.并且为了实现帧的传输,本章数据链路层将介绍两种类型的信道:  
1. 点对点链路: 两个相邻节点,通过单一链路连接,第三方无法收到任何信息.应用在广域网中,即用户和ISP的通信中.
2. 广播信道:  链路上所有主机共享通信介质.应用在局域网中.局域网的拓补结构分为早期的总线型和后来的星型.
### 3.1.2 三个基本问题
###### 封装成帧
- 数据链路层收到从物理层交上来的bit,然后把这些bit封装成数据链路层的帧.并且需要自己完成对帧的定界(而且在每种协议中,帧的**格式**和**长度**也被规定了).
###### 透明传输
- 不管物理层交上来的是怎样的bit流,这些bit流在经数据链路层包装的时候,数据链路层对它们而言就好像是透明的一样,完全不会影响他们的传输,这就叫做透明传输.为了实现透明传输,可以使用 ***字节传输(byte stuffing)***或 ***字符传输(character stuffing)***.
###### 差错检测
- 什么是差错检测: 
    - bit的传输可能会出现错误,物理层没有保证100%传输出正确的bit,数据链路层则保证了bit的可靠传输.比如物理层本来要传一个"1111",但是出现了误码,传出了一个"1110".而**只保证可靠的bit传输**的数据链路层,它只管自己收到了"1110",所以它必须保证把"1110"传出去,而不管这个"1110"本身的正确与否.这就是数据链路层的差错检测,它并没有为网络层提供可靠的传输服务,只为数据链路层提供了可靠的bit传输.
- 差错的类型:
    - 比特差错: 上例保证了"无比特差错".
    - 传输差错: 上例没有把"1110"的错误纠正回来,所以并没有保证"无传输差错".
- 差错检测采用的手段:
    - 在数据的后面添加供差错检测用的n位冗余码.这n位冗余码被称为 ***帧检验序列FCS(Frame Check Sequence)***.
- 差错检测采用的一种方法:
    - 不同的检错方法会添加不同的FCS,只要这个FCS能保证出错概率极小即可.而 ***循环冗余检验CRC(Cyclic Redundancy Check)***是方法之一,它使用模2运算来求得FCS,具体实现细节见**书本P74&75**.
## 3.2 点对点信道-接入网
互联网用户通常都要连接到某个ISP才能接入互联网,而Client<->Server的连接并不需要被第三方知道,所以这一种点对点的通信,它使用 ***PPP协议(Point-to-Point Protocol)***.
### 3.2.1 PPP协议的特点
除了最基本的**封装成帧**|**透明传输**|**差错检测**之外,PPP协议还拥有以下特点:
- **简单**: 对于本层,只保证无比特差错,不保证无传输差错,在整个网络中,它是不可靠的.
- **多种网络层协议**: 对于上层,能够满足网络层和数据链路层之间的接口,即能在同一条物理链路上支持多种网络层协议.这部分交给**网络控制协议NCP**.
- **多种类型链路**: 对于下层,满足物理层和数据链路层之间的接口,即能够在各种不同的物理链路上运行.
- **检测连接状态**: 对于本层,必须有一种机制能够及时检测链路的工作状态.这部分交给**链路控制协议LCP**.
- **最大传送单元**: 对于本层,对于基本的封装成帧要求,要规定**数据部分**的最大长度(非**帧总长**).
- **网络层地址协商**: 对于上层,让上层网络层能够通过协商互相知道彼此的网络层地址.
- **数据压缩协商**: 对于本层,要提供算法将数据部分压缩.
### 3.2.2 PPP协议的帧格式
###### 各字段的意义:
1. 首部:
    1. 标志字段F(Flag): 长度1B,规定为0x7E(01111110).
    2. 地址字段A(Access): 长度1B,规定为0xFF(11111111).
    3. 控制字段C(Control): 长度1B,规定为0x03(00000011).
    4. 协议字段: 长度2B,IP协议规位0x0021(00000000 00100001).
2. 信息部分(IP数据报)
    - **最大传送单元MTU(Maximum Transmission Unit)**规定不超过1500B.
3. 尾部
    1. 帧检验序列FCS: 使用的是循环冗余检验CRC算法.
    2. 标志字段F(Flag): 规定为0x7E(01111110).
###### 字节填充:
- 当PPP使用异步传输时,采用字节填充,规定转义字符为0x7D(01111101):
    1. 信息字段中的0x7E -> 0x7D,0x5E.
    2. 信息字段中的0x7D -> 0x7D,0x5D.
    3. 信息字段中的ASCII码控制字符(数值小于0x20) -> 0x7D,该控制字符.
###### 字符填充:
- 当PPP使用同步传输时,采用"零比特填充": 只要发现有5个连续1,则立即填入一个0.
### 3.2.3 PPP协议的工作状态
1. 开始是**链路静止状态**.用户和ISP不存在物理层的连接.
2. 用户发送请求后,路由器侦测到信号,物理层已连接,进入**链路建立状态**.目的是为了建立链路层的LCP连接.
3. 链路控制协议LCP开始协商配置选项,一端发送LCP的配置请求帧.另一端发送如下响应:
    - 配置确认帧: 全部接受.
    - 配置否认帧: 全部不接受.
    - 配置拒绝帧: 部分不理解或不接受,需要再协商.
4. 建立好LCP链路,进入**鉴别状态**,只允许传送LCP协议的分组&鉴别协议的分组&监测链路质量的分组.鉴别失败则返回**链路静止状态**,鉴别成功则进入**网络层协议状态**.
5. 在**网络层协议状态**,PPP链路两端的网络控制协议NCP根据网络层的不同协议互相交换网络控制分组.这样,PPP链路两端的网络层可以在同一个PPP协议上运行不同的网路层协议.
6. 网络层配置完毕,链路进入可通信的**链路打开状态**,两个PPP端点可以相互发送PPP分组了.
7. 数据传输结束,一端发送终止请求LCP分组,另一端确认该分组后,转到**链路终止状态**(通信期间出现故障也会转到该状态).当调制解调器的载波停止后,物理层的连接也断开,回到**链路静止状态**.
## 3.3 广播信道-局域网
### 3.3.1 局域网特性
1. 介质访问控制
2. 拓补结构
3. 带宽
4. 标准
### 3.3.2 常见以太网
1. 传统以太网-共享总线
2. 星型以太网
3. 高速以太网
### 3.3.3 局域网通信
1. 地址-MAC地址
2. 格式-MAC帧格式
### 3.3.4 拓展以太网
1. 物理层拓展-集线器
2. 链路层拓展-交换机
### 3.3.5 虚拟局域网
1. 含义
2. 应用
3. 如何划分
4. 帧格式